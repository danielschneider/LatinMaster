<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latin Master</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1a1a2e;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #fff;
        }

        .container {
            width: 100%;
            max-width: 700px;
            padding: 20px 10px;
        }
        
        .score-display {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        .score-item {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .score-correct {
            background-color: #10b981;
            color: #fff;
        }
        
        .score-incorrect {
            background-color: #ef4444;
            color: #fff;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            color: #fff;
        }

        .mode-switch {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            justify-content: center;
        }

        .mode-btn {
            padding: 12px 24px;
            border: 2px solid #6366f1;
            background-color: transparent;
            color: #6366f1;
            font-size: 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .mode-btn.active {
            background-color: #6366f1;
            color: #1a1a2e;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .content {
            background-color: #16213e;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #0f3460;
        }

        .question {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: center;
            color: #6366f1;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toggles-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .toggles-grid > .toggle-group:nth-child(1) {
            grid-row: 1 / 3;
        }
        
        .toggles-grid > .toggle-group:nth-child(2) {
            grid-column: 2;
            grid-row: 1;
        }
        
        .toggles-grid > .toggle-group:nth-child(3) {
            grid-column: 2;
            grid-row: 2;
        }

        @media (max-width: 600px) {
            .toggles-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            
            .toggles-grid > .toggle-group {
                grid-row: auto;
                grid-column: 1;
            }
            
            h1 {
                font-size: 2rem;
                margin-bottom: 10px;
            }
            
            .mode-switch {
                margin-bottom: 20px;
                gap: 8px;
            }
            
            .mode-btn {
                padding: 8px 12px;
                font-size: 0.75rem;
                flex: 1;
            }
            
            .question {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }
            
            .content {
                padding: 15px;
            }
            
            .toggle-btn {
                padding: 8px 10px;
                font-size: 0.8rem;
            }
            
            .ok-btn, .next-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .score-display {
                gap: 10px;
                margin-bottom: 15px;
                font-size: 0.8rem;
            }
            
            .score-item {
                padding: 6px 12px;
            }
        }

        .toggle-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toggle-label {
            font-size: 0.9rem;
            color: #aaa;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .toggle-options {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .toggle-btn {
            padding: 10px 12px;
            border: 2px solid #0f3460;
            background-color: #0f3460;
            color: #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .toggle-btn.selected {
            background-color: #6366f1;
            color: #fff;
            border-color: #6366f1;
        }

        .toggle-btn:hover {
            border-color: #6366f1;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid #0f3460;
            background-color: #0f3460;
            color: #fff;
            border-radius: 6px;
            margin-bottom: 30px;
            transition: all 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #6366f1;
            background-color: #16213e;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .ok-btn, .next-btn {
            padding: 14px 40px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .ok-btn {
            background-color: #6366f1;
            color: #fff;
        }

        .ok-btn:hover {
            background-color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .next-btn {
            background-color: #0f3460;
            color: #6366f1;
        }

        .next-btn:hover {
            background-color: #16213e;
        }

        .feedback {
            margin-top: 30px;
            padding: 15px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback.correct {
            background-color: #10b981;
            color: #fff;
        }

        .feedback.incorrect {
            background-color: #ef4444;
            color: #fff;
        }

        .feedback.hidden {
            display: none;
        }

        .hint {
            margin-top: 20px;
            padding: 12px;
            background-color: #0f3460;
            border-left: 4px solid #6366f1;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #bbb;
        }

        .mode-1 {
            display: none;
        }

        .mode-1.active {
            display: block;
        }

        .mode-2 {
            display: none;
        }

        .mode-2.active {
            display: block;
        }

        .mode-3 {
            display: none;
        }

        .mode-3.active {
            display: block;
        }

        .verb-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .verb-btn {
            padding: 10px 16px;
            border: 2px solid #0f3460;
            background-color: #0f3460;
            color: #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .verb-btn.selected {
            background-color: #6366f1;
            color: #fff;
            border-color: #6366f1;
        }

        .verb-btn:hover {
            border-color: #6366f1;
        }

        .conjugation-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .conjugation-table th {
            background-color: #0f3460;
            padding: 12px;
            text-align: left;
            color: #6366f1;
            font-weight: 600;
            border: 1px solid #1a4d6d;
        }

        .conjugation-table td {
            padding: 12px;
            border: 1px solid #0f3460;
            color: #ccc;
        }

        .conjugation-table tr:hover td {
            background-color: #0f3460;
        }

        .conjugation-table .tense-header {
            background-color: #1a4d6d;
            color: #fff;
            font-weight: 600;
        }

        @media (max-width: 600px) {
            .verb-selector {
                gap: 8px;
            }

            .verb-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .conjugation-table {
                font-size: 0.8rem;
            }

            .conjugation-table th,
            .conjugation-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Konjugationsquäler</h1>
        
        <div class="score-display">
            <div class="score-item score-correct">✓ <span id="score-correct">0</span></div>
            <div class="score-item score-incorrect">✗ <span id="score-incorrect">0</span></div>
        </div>
        
        <div class="mode-switch">
            <button class="mode-btn active" onclick="switchMode(1)">Modus 1: Form erraten</button>
            <button class="mode-btn" onclick="switchMode(2)">Modus 2: Form eingeben</button>
            <button class="mode-btn" onclick="switchMode(3)">Modus 3: Tabelle</button>
        </div>

        <!-- MODE 1: GUESS THE FORM -->
        <div class="mode-1 active">
            <div class="content">
                <div class="question" id="mode1-question">amat</div>
                
                <div class="toggles-grid">
                    <div class="toggle-group">
                        <div class="toggle-label">Zeit</div>
                        <div class="toggle-options">
                            <button class="toggle-btn" onclick="toggleSelection('tense', 'present')">Präsens</button>
                            <button class="toggle-btn" onclick="toggleSelection('tense', 'imperfect')">Imperfekt</button>
                            <button class="toggle-btn" onclick="toggleSelection('tense', 'perfect')">Perfekt</button>
                            <button class="toggle-btn" onclick="toggleSelection('tense', 'plusquamperfect')">Plusquamperfekt</button>
                            <button class="toggle-btn" onclick="toggleSelection('tense', 'future1')">Futur 1</button>
                        </div>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-label">Person</div>
                        <div class="toggle-options">
                            <button class="toggle-btn" onclick="toggleSelection('person', '1')">1. Pers.</button>
                            <button class="toggle-btn" onclick="toggleSelection('person', '2')">2. Pers.</button>
                            <button class="toggle-btn" onclick="toggleSelection('person', '3')">3. Pers.</button>
                        </div>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-label">Numerus</div>
                        <div class="toggle-options">
                            <button class="toggle-btn" onclick="toggleSelection('number', 'sg')">Singular</button>
                            <button class="toggle-btn" onclick="toggleSelection('number', 'pl')">Plural</button>
                        </div>
                    </div>
                </div>

                <div class="buttons">
                    <button class="ok-btn" onclick="checkMode1()">Prüfen</button>
                </div>

                <div class="feedback hidden" id="mode1-feedback"></div>
            </div>
        </div>

        <!-- MODE 2: TYPE THE FORM -->
        <div class="mode-2">
            <div class="content">
                <div style="background-color: #0f3460; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <div style="font-size: 0.9rem; color: #888; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; margin-bottom: 10px;">Konjugiere:</div>
                    <div style="font-size: 1.5rem; font-weight: 600; color: #6366f1; margin-bottom: 15px;" id="mode2-verb">amare</div>
                    <div style="display: flex; flex-direction: column; gap: 8px; font-size: 1.1rem; color: #ccc;">
                        <div><span style="color: #888;">Zeit:</span> <span style="color: #fff; font-weight: 600;" id="mode2-tense">Präsens</span></div>
                        <div><span style="color: #888;">Person:</span> <span style="color: #fff; font-weight: 600;" id="mode2-person">1. Pers.</span></div>
                        <div><span style="color: #888;">Numerus:</span> <span style="color: #fff; font-weight: 600;" id="mode2-number">Singular</span></div>
                    </div>
                </div>
                
                <input type="text" class="input-field" id="mode2-input" placeholder="Form eingeben (Makronen optional)..." onkeypress="handleEnter(event)" autocomplete="off" autofocus>

                <div class="buttons">
                    <button class="ok-btn" onclick="checkMode2()">Prüfen</button>
                </div>

                <div class="feedback hidden" id="mode2-feedback"></div>
                <div class="hint hidden" id="mode2-hint"></div>
            </div>
        </div>

        <!-- MODE 3: CONJUGATION TABLE -->
        <div class="mode-3">
            <div class="content">
                <div style="margin-bottom: 25px;">
                    <div style="font-size: 0.9rem; color: #888; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; margin-bottom: 15px;">Wähle ein Verb:</div>
                    <div class="verb-selector" id="verb-selector"></div>
                </div>
                <div id="table-container">
                    <!-- Table will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Helper function to remove macrons for comparison
        function removeMacrons(text) {
            return text
                .replace(/ā/g, 'a')
                .replace(/ē/g, 'e')
                .replace(/ī/g, 'i')
                .replace(/ō/g, 'o')
                .replace(/ū/g, 'u')
                .replace(/Ā/g, 'A')
                .replace(/Ē/g, 'E')
                .replace(/Ī/g, 'I')
                .replace(/Ō/g, 'O')
                .replace(/Ū/g, 'U');
        }

        // Verb conjugation database
        const verbs = {
            esse: {
                infinitive: 'esse',
                translation: 'to be',
                conjugations: {
                    present: {
                        sg: { '1': 'sum', '2': 'es', '3': 'est' },
                        pl: { '1': 'sumus', '2': 'estis', '3': 'sunt' }
                    },
                    imperfect: {
                        sg: { '1': 'ēram', '2': 'ērās', '3': 'ērat' },
                        pl: { '1': 'ērāmus', '2': 'ērātis', '3': 'ērant' }
                    },
                    perfect: {
                        sg: { '1': 'fuī', '2': 'fuistī', '3': 'fuit' },
                        pl: { '1': 'fuimus', '2': 'fuistis', '3': 'fuērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'fueram', '2': 'fuerās', '3': 'fuerat' },
                        pl: { '1': 'fuerāmus', '2': 'fuerātis', '3': 'fuerant' }
                    },
                    future1: {
                        sg: { '1': 'erō', '2': 'eris', '3': 'erit' },
                        pl: { '1': 'erimus', '2': 'eritis', '3': 'erunt' }
                    }
                }
            },
            velle: {
                infinitive: 'velle',
                translation: 'to want',
                conjugations: {
                    present: {
                        sg: { '1': 'volō', '2': 'vis', '3': 'vult' },
                        pl: { '1': 'volumus', '2': 'vultis', '3': 'volunt' }
                    },
                    imperfect: {
                        sg: { '1': 'volēbam', '2': 'volēbās', '3': 'volēbat' },
                        pl: { '1': 'volēbāmus', '2': 'volēbātis', '3': 'volēbant' }
                    },
                    perfect: {
                        sg: { '1': 'voluī', '2': 'volustī', '3': 'voluit' },
                        pl: { '1': 'voluimus', '2': 'voluistis', '3': 'voluerunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'volueram', '2': 'volueras', '3': 'voluerat' },
                        pl: { '1': 'volueramus', '2': 'volueratis', '3': 'voluerant' }
                    },
                    future1: {
                        sg: { '1': 'volam', '2': 'volēs', '3': 'volet' },
                        pl: { '1': 'volēmus', '2': 'volētis', '3': 'volent' }
                    }
                }
            },
            nolle: {
                infinitive: 'nolle',
                translation: 'not to want',
                conjugations: {
                    present: {
                        sg: { '1': 'nolō', '2': 'non vis', '3': 'non vult' },
                        pl: { '1': 'nolumus', '2': 'non vultis', '3': 'nolunt' }
                    },
                    imperfect: {
                        sg: { '1': 'nolēbam', '2': 'nolēbās', '3': 'nolēbat' },
                        pl: { '1': 'nolēbāmus', '2': 'nolēbātis', '3': 'nolēbant' }
                    },
                    perfect: {
                        sg: { '1': 'noluī', '2': 'nolustī', '3': 'noluit' },
                        pl: { '1': 'noluimus', '2': 'noluistis', '3': 'noluērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'nolueram', '2': 'noluerās', '3': 'noluerat' },
                        pl: { '1': 'noluerāmus', '2': 'noluerātis', '3': 'noluerant' }
                    },
                    future1: {
                        sg: { '1': 'nolam', '2': 'nolēs', '3': 'nolet' },
                        pl: { '1': 'nolēmus', '2': 'nolētis', '3': 'nolent' }
                    }
                }
            },
            amare: {
                infinitive: 'amare',
                translation: 'to love',
                conjugations: {
                    present: {
                        sg: { '1': 'amō', '2': 'amās', '3': 'amat' },
                        pl: { '1': 'amāmus', '2': 'amātis', '3': 'amant' }
                    },
                    imperfect: {
                        sg: { '1': 'amābam', '2': 'amābās', '3': 'amābat' },
                        pl: { '1': 'amābāmus', '2': 'amābātis', '3': 'amābant' }
                    },
                    perfect: {
                        sg: { '1': 'amāvī', '2': 'amāvistī', '3': 'amāvit' },
                        pl: { '1': 'amāvimus', '2': 'amāvistis', '3': 'amāvērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'amāveram', '2': 'amāverās', '3': 'amāverat' },
                        pl: { '1': 'amāverāmus', '2': 'amāverātis', '3': 'amāverant' }
                    },
                    future1: {
                        sg: { '1': 'amābō', '2': 'amābis', '3': 'amābit' },
                        pl: { '1': 'amābimus', '2': 'amābitis', '3': 'amābunt' }
                    }
                }
            },
            laudare: {
                infinitive: 'laudare',
                translation: 'to praise',
                conjugations: {
                    present: {
                        sg: { '1': 'laudō', '2': 'laudās', '3': 'laudat' },
                        pl: { '1': 'laudāmus', '2': 'laudātis', '3': 'laudant' }
                    },
                    imperfect: {
                        sg: { '1': 'laudābam', '2': 'laudābās', '3': 'laudābat' },
                        pl: { '1': 'laudābāmus', '2': 'laudābātis', '3': 'laudābant' }
                    },
                    perfect: {
                        sg: { '1': 'laudāvī', '2': 'laudāvistī', '3': 'laudāvit' },
                        pl: { '1': 'laudāvimus', '2': 'laudāvistis', '3': 'laudāvērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'laudāveram', '2': 'laudāverās', '3': 'laudāverat' },
                        pl: { '1': 'laudāverāmus', '2': 'laudāverātis', '3': 'laudāverant' }
                    },
                    future1: {
                        sg: { '1': 'laudābō', '2': 'laudābis', '3': 'laudābit' },
                        pl: { '1': 'laudābimus', '2': 'laudābitis', '3': 'laudābunt' }
                    }
                }
            },
            dire: {
                infinitive: 'dire',
                translation: 'to say',
                conjugations: {
                    present: {
                        sg: { '1': 'dīcō', '2': 'dīcis', '3': 'dīcit' },
                        pl: { '1': 'dīcimus', '2': 'dīcitis', '3': 'dīcunt' }
                    },
                    imperfect: {
                        sg: { '1': 'dīcēbam', '2': 'dīcēbās', '3': 'dīcēbat' },
                        pl: { '1': 'dīcēbāmus', '2': 'dīcēbātis', '3': 'dīcēbant' }
                    },
                    perfect: {
                        sg: { '1': 'dīxī', '2': 'dīxistī', '3': 'dīxit' },
                        pl: { '1': 'dīximus', '2': 'dīxistis', '3': 'dīxērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'dīxeram', '2': 'dīxerās', '3': 'dīxerat' },
                        pl: { '1': 'dīxerāmus', '2': 'dīxerātis', '3': 'dīxerant' }
                    },
                    future1: {
                        sg: { '1': 'dīcam', '2': 'dīces', '3': 'dīcet' },
                        pl: { '1': 'dīcemus', '2': 'dīcetis', '3': 'dīcent' }
                    }
                }
            },
            perdere: {
                infinitive: 'perdere',
                translation: 'to lose/destroy',
                conjugations: {
                    present: {
                        sg: { '1': 'perdō', '2': 'perdis', '3': 'perdit' },
                        pl: { '1': 'perdimus', '2': 'perditis', '3': 'perdunt' }
                    },
                    imperfect: {
                        sg: { '1': 'perdēbam', '2': 'perdēbās', '3': 'perdēbat' },
                        pl: { '1': 'perdēbāmus', '2': 'perdēbātis', '3': 'perdēbant' }
                    },
                    perfect: {
                        sg: { '1': 'perdidī', '2': 'perdidistī', '3': 'perdidit' },
                        pl: { '1': 'perdidimus', '2': 'perdidistis', '3': 'perdidērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'perdideram', '2': 'perdiderās', '3': 'perdiderat' },
                        pl: { '1': 'perdiderāmus', '2': 'perdiderātis', '3': 'perdiderant' }
                    },
                    future1: {
                        sg: { '1': 'perdām', '2': 'perdēs', '3': 'perdet' },
                        pl: { '1': 'perdēmus', '2': 'perdētis', '3': 'perdent' }
                    }
                }
            },
            credere: {
                infinitive: 'credere',
                translation: 'to believe',
                conjugations: {
                    present: {
                        sg: { '1': 'credō', '2': 'credis', '3': 'credit' },
                        pl: { '1': 'credimus', '2': 'creditis', '3': 'credunt' }
                    },
                    imperfect: {
                        sg: { '1': 'credēbam', '2': 'credēbās', '3': 'credēbat' },
                        pl: { '1': 'credēbāmus', '2': 'credēbātis', '3': 'credēbant' }
                    },
                    perfect: {
                        sg: { '1': 'credidī', '2': 'credidistī', '3': 'credidit' },
                        pl: { '1': 'credidimus', '2': 'credidistis', '3': 'credidērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'credideram', '2': 'crediderās', '3': 'crediderat' },
                        pl: { '1': 'crediderāmus', '2': 'crediderātis', '3': 'crediderant' }
                    },
                    future1: {
                        sg: { '1': 'credām', '2': 'credēs', '3': 'credet' },
                        pl: { '1': 'credēmus', '2': 'credētis', '3': 'credent' }
                    }
                }
            },
            habere: {
                infinitive: 'habere',
                translation: 'to have',
                conjugations: {
                    present: {
                        sg: { '1': 'habeō', '2': 'habēs', '3': 'habet' },
                        pl: { '1': 'habēmus', '2': 'habētis', '3': 'habent' }
                    },
                    imperfect: {
                        sg: { '1': 'habēbam', '2': 'habēbās', '3': 'habēbat' },
                        pl: { '1': 'habēbāmus', '2': 'habēbātis', '3': 'habēbant' }
                    },
                    perfect: {
                        sg: { '1': 'habuī', '2': 'habuistī', '3': 'habuit' },
                        pl: { '1': 'habuimus', '2': 'habuistis', '3': 'habuērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'habueram', '2': 'habuerās', '3': 'habuerat' },
                        pl: { '1': 'habuerāmus', '2': 'habuerātis', '3': 'habuerant' }
                    },
                    future1: {
                        sg: { '1': 'habēbō', '2': 'habēbis', '3': 'habēbit' },
                        pl: { '1': 'habēbimus', '2': 'habēbitis', '3': 'habēbunt' }
                    }
                }
            },
            mittere: {
                infinitive: 'mittere',
                translation: 'to send',
                conjugations: {
                    present: {
                        sg: { '1': 'mittō', '2': 'mittis', '3': 'mittit' },
                        pl: { '1': 'mittimus', '2': 'mittitis', '3': 'mittunt' }
                    },
                    imperfect: {
                        sg: { '1': 'mittēbam', '2': 'mittēbās', '3': 'mittēbat' },
                        pl: { '1': 'mittēbāmus', '2': 'mittēbātis', '3': 'mittēbant' }
                    },
                    perfect: {
                        sg: { '1': 'mīsī', '2': 'mīsistī', '3': 'mīsit' },
                        pl: { '1': 'mīsimus', '2': 'mīsistis', '3': 'mīsērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'mīseram', '2': 'mīserās', '3': 'mīserat' },
                        pl: { '1': 'mīserāmus', '2': 'mīserātis', '3': 'mīserant' }
                    },
                    future1: {
                        sg: { '1': 'mittam', '2': 'mittēs', '3': 'mittet' },
                        pl: { '1': 'mittēmus', '2': 'mittētis', '3': 'mittent' }
                    }
                }
            },
            interficere: {
                infinitive: 'interficere',
                translation: 'to kill',
                conjugations: {
                    present: {
                        sg: { '1': 'interficiō', '2': 'interficis', '3': 'interficit' },
                        pl: { '1': 'interficimus', '2': 'interficitis', '3': 'interficiunt' }
                    },
                    imperfect: {
                        sg: { '1': 'interficiēbam', '2': 'interficiēbās', '3': 'interficiēbat' },
                        pl: { '1': 'interficiēbāmus', '2': 'interficiēbātis', '3': 'interficiēbant' }
                    },
                    perfect: {
                        sg: { '1': 'interfēcī', '2': 'interfecistī', '3': 'interfēcit' },
                        pl: { '1': 'interfēcimus', '2': 'interfēcistis', '3': 'interfēcērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'interfēceram', '2': 'interfēcerās', '3': 'interfēcerat' },
                        pl: { '1': 'interfēcerāmus', '2': 'interfēcerātis', '3': 'interfēcerant' }
                    },
                    future1: {
                        sg: { '1': 'interficiam', '2': 'interficiēs', '3': 'interficiet' },
                        pl: { '1': 'interficiēmus', '2': 'interficiētis', '3': 'interficient' }
                    }
                }
            },
            imperare: {
                infinitive: 'imperare',
                translation: 'to command',
                conjugations: {
                    present: {
                        sg: { '1': 'imperō', '2': 'imperās', '3': 'imperat' },
                        pl: { '1': 'imperāmus', '2': 'imperātis', '3': 'imperant' }
                    },
                    imperfect: {
                        sg: { '1': 'imperābam', '2': 'imperābās', '3': 'imperābat' },
                        pl: { '1': 'imperābāmus', '2': 'imperābātis', '3': 'imperābant' }
                    },
                    perfect: {
                        sg: { '1': 'imperāvī', '2': 'imperāvistī', '3': 'imperāvit' },
                        pl: { '1': 'imperāvimus', '2': 'imperāvistis', '3': 'imperāvērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'imperāveram', '2': 'imperāverās', '3': 'imperāverat' },
                        pl: { '1': 'imperāverāmus', '2': 'imperāverātis', '3': 'imperāverant' }
                    },
                    future1: {
                        sg: { '1': 'imperābō', '2': 'imperābis', '3': 'imperābit' },
                        pl: { '1': 'imperābimus', '2': 'imperābitis', '3': 'imperābunt' }
                    }
                }
            },
            iubere: {
                infinitive: 'iubere',
                translation: 'to order',
                conjugations: {
                    present: {
                        sg: { '1': 'iubeō', '2': 'iubēs', '3': 'iubet' },
                        pl: { '1': 'iubēmus', '2': 'iubētis', '3': 'iubent' }
                    },
                    imperfect: {
                        sg: { '1': 'iubēbam', '2': 'iubēbās', '3': 'iubēbat' },
                        pl: { '1': 'iubēbāmus', '2': 'iubēbātis', '3': 'iubēbant' }
                    },
                    perfect: {
                        sg: { '1': 'iussī', '2': 'iussistī', '3': 'iussit' },
                        pl: { '1': 'iussimus', '2': 'iussistis', '3': 'iussērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'iusseram', '2': 'iusserās', '3': 'iusserat' },
                        pl: { '1': 'iusserāmus', '2': 'iusserātis', '3': 'iusserant' }
                    },
                    future1: {
                        sg: { '1': 'iubēbō', '2': 'iubēbis', '3': 'iubēbit' },
                        pl: { '1': 'iubēbimus', '2': 'iubēbitis', '3': 'iubēbunt' }
                    }
                }
            },
            superare: {
                infinitive: 'superare',
                translation: 'to overcome',
                conjugations: {
                    present: {
                        sg: { '1': 'superō', '2': 'superās', '3': 'superat' },
                        pl: { '1': 'superāmus', '2': 'superātis', '3': 'superant' }
                    },
                    imperfect: {
                        sg: { '1': 'superābam', '2': 'superābās', '3': 'superābat' },
                        pl: { '1': 'superābāmus', '2': 'superābātis', '3': 'superābant' }
                    },
                    perfect: {
                        sg: { '1': 'superāvī', '2': 'superāvistī', '3': 'superāvit' },
                        pl: { '1': 'superāvimus', '2': 'superāvistis', '3': 'superāvērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'superāveram', '2': 'superāverās', '3': 'superāverat' },
                        pl: { '1': 'superāverāmus', '2': 'superāverātis', '3': 'superāverant' }
                    },
                    future1: {
                        sg: { '1': 'superābō', '2': 'superābis', '3': 'superābit' },
                        pl: { '1': 'superābimus', '2': 'superābitis', '3': 'superābunt' }
                    }
                }
            },
            appellare: {
                infinitive: 'appellare',
                translation: 'to call/name',
                conjugations: {
                    present: {
                        sg: { '1': 'appellō', '2': 'appellās', '3': 'appellat' },
                        pl: { '1': 'appellāmus', '2': 'appellātis', '3': 'appellant' }
                    },
                    imperfect: {
                        sg: { '1': 'appellābam', '2': 'appellābās', '3': 'appellābat' },
                        pl: { '1': 'appellābāmus', '2': 'appellābātis', '3': 'appellābant' }
                    },
                    perfect: {
                        sg: { '1': 'appellāvī', '2': 'appellāvistī', '3': 'appellāvit' },
                        pl: { '1': 'appellāvimus', '2': 'appellāvistis', '3': 'appellāvērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'appellāveram', '2': 'appellāverās', '3': 'appellāverat' },
                        pl: { '1': 'appellāverāmus', '2': 'appellāverātis', '3': 'appellāverant' }
                    },
                    future1: {
                        sg: { '1': 'appellābō', '2': 'appellābis', '3': 'appellābit' },
                        pl: { '1': 'appellābimus', '2': 'appellābitis', '3': 'appellābunt' }
                    }
                }
            },
            occurrere: {
                infinitive: 'occurrere',
                translation: 'to encounter',
                conjugations: {
                    present: {
                        sg: { '1': 'occurrō', '2': 'occurris', '3': 'occurrit' },
                        pl: { '1': 'occurrimus', '2': 'occurritis', '3': 'occurrunt' }
                    },
                    imperfect: {
                        sg: { '1': 'occurrēbam', '2': 'occurrēbās', '3': 'occurrēbat' },
                        pl: { '1': 'occurrēbāmus', '2': 'occurrēbātis', '3': 'occurrēbant' }
                    },
                    perfect: {
                        sg: { '1': 'occurrī', '2': 'occurristī', '3': 'occurrit' },
                        pl: { '1': 'occurrimus', '2': 'occurristis', '3': 'ocurrērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'occurreram', '2': 'occurrerās', '3': 'occurrerat' },
                        pl: { '1': 'occurrerāmus', '2': 'occurrerātis', '3': 'occurrerant' }
                    },
                    future1: {
                        sg: { '1': 'occurram', '2': 'occurrēs', '3': 'occurret' },
                        pl: { '1': 'occurrēmus', '2': 'occurrētis', '3': 'occurrent' }
                    }
                }
            },
            sedere: {
                infinitive: 'sedere',
                translation: 'to sit',
                conjugations: {
                    present: {
                        sg: { '1': 'sedeō', '2': 'sedēs', '3': 'sedet' },
                        pl: { '1': 'sedēmus', '2': 'sedētis', '3': 'sedent' }
                    },
                    imperfect: {
                        sg: { '1': 'sedēbam', '2': 'sedēbās', '3': 'sedēbat' },
                        pl: { '1': 'sedēbāmus', '2': 'sedēbātis', '3': 'sedēbant' }
                    },
                    perfect: {
                        sg: { '1': 'sedī', '2': 'sedistī', '3': 'sedit' },
                        pl: { '1': 'sedimus', '2': 'sedistis', '3': 'sedērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'sederam', '2': 'sederās', '3': 'sederat' },
                        pl: { '1': 'sederāmus', '2': 'sederātis', '3': 'sederant' }
                    },
                    future1: {
                        sg: { '1': 'sedēbō', '2': 'sedēbis', '3': 'sedēbit' },
                        pl: { '1': 'sedēbimus', '2': 'sedēbitis', '3': 'sedēbunt' }
                    }
                }
            },
            relinquere: {
                infinitive: 'relinquere',
                translation: 'to leave/abandon',
                conjugations: {
                    present: {
                        sg: { '1': 'relinquō', '2': 'relinquis', '3': 'relinquit' },
                        pl: { '1': 'relinquimus', '2': 'relinquitis', '3': 'relinquunt' }
                    },
                    imperfect: {
                        sg: { '1': 'relinquēbam', '2': 'relinquēbās', '3': 'relinquēbat' },
                        pl: { '1': 'relinquēbāmus', '2': 'relinquēbātis', '3': 'relinquēbant' }
                    },
                    perfect: {
                        sg: { '1': 'relīquī', '2': 'relīquistī', '3': 'relīquit' },
                        pl: { '1': 'relīquimus', '2': 'relīquistis', '3': 'relīquērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'relīqueram', '2': 'relīquerās', '3': 'relīquerat' },
                        pl: { '1': 'relīquerāmus', '2': 'relīquerātis', '3': 'relīquerant' }
                    },
                    future1: {
                        sg: { '1': 'relinquam', '2': 'relinquēs', '3': 'relinquet' },
                        pl: { '1': 'relinquēmus', '2': 'relinquētis', '3': 'relinquent' }
                    }
                }
            },
            aperire: {
                infinitive: 'aperire',
                translation: 'to open',
                conjugations: {
                    present: {
                        sg: { '1': 'aperiō', '2': 'aperis', '3': 'aperit' },
                        pl: { '1': 'aperimus', '2': 'aperitis', '3': 'aperiunt' }
                    },
                    imperfect: {
                        sg: { '1': 'aperiēbam', '2': 'aperiēbās', '3': 'aperiēbat' },
                        pl: { '1': 'aperiēbāmus', '2': 'aperiēbātis', '3': 'aperiēbant' }
                    },
                    perfect: {
                        sg: { '1': 'aperuī', '2': 'aperuistī', '3': 'aperuit' },
                        pl: { '1': 'aperuimus', '2': 'aperuistis', '3': 'aperuērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'aperueram', '2': 'aperuerās', '3': 'aperuerat' },
                        pl: { '1': 'aperuerāmus', '2': 'aperuerātis', '3': 'aperuerant' }
                    },
                    future1: {
                        sg: { '1': 'aperiam', '2': 'aperiēs', '3': 'aperiet' },
                        pl: { '1': 'aperiēmus', '2': 'aperiētis', '3': 'aperient' }
                    }
                }
            },
            monere: {
                infinitive: 'monere',
                translation: 'to warn/advise',
                conjugations: {
                    present: {
                        sg: { '1': 'moneō', '2': 'monēs', '3': 'monet' },
                        pl: { '1': 'monēmus', '2': 'monētis', '3': 'monent' }
                    },
                    imperfect: {
                        sg: { '1': 'monēbam', '2': 'monēbās', '3': 'monēbat' },
                        pl: { '1': 'monēbāmus', '2': 'monēbātis', '3': 'monēbant' }
                    },
                    perfect: {
                        sg: { '1': 'monuī', '2': 'monuistī', '3': 'monuit' },
                        pl: { '1': 'monuimus', '2': 'monuistis', '3': 'monuērunt' }
                    },
                    plusquamperfect: {
                        sg: { '1': 'monueram', '2': 'monuerās', '3': 'monuerat' },
                        pl: { '1': 'monuerāmus', '2': 'monuerātis', '3': 'monuerant' }
                    },
                    future1: {
                        sg: { '1': 'monēbō', '2': 'monēbis', '3': 'monēbit' },
                        pl: { '1': 'monēbimus', '2': 'monēbitis', '3': 'monēbunt' }
                    }
                }
            }
        };

        const tenseLongNames = {
            present: 'Präsens',
            imperfect: 'Imperfekt',
            perfect: 'Perfekt',
            plusquamperfect: 'Plusquamperfekt',
            future1: 'Futur 1'
        };

        const personNames = {
            '1': '1. Person',
            '2': '2. Person',
            '3': '3. Person'
        };

        const numberNames = {
            sg: 'Singular',
            pl: 'Plural'
        };

        // State for Mode 1
        let mode1State = {
            verb: 'amare',
            form: null,
            selected: { tense: null, person: null, number: null }
        };
        
        // Score tracking
        let scoreState = {
            correct: 0,
            incorrect: 0
        };
        
        // Timeout tracking for auto-advance
        let pendingTimeout = null;
        
        // Track if last check was an error (for Mode 1)
        let mode1LastError = false;
        
        // Track if last check was an error (for Mode 2)
        let mode2LastError = false;
        
        // Track if a check is currently in progress (prevents button hammering)
        let checkInProgress = false;

        // State for Mode 2
        let mode2State = {
            verb: 'amare',
            form: null,
            currentQuestion: {}
        };

        function switchMode(mode) {
            document.querySelector('.mode-1').classList.remove('active');
            document.querySelector('.mode-2').classList.remove('active');
            document.querySelector('.mode-3').classList.remove('active');
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            
            // Reset error flags when switching modes
            mode1LastError = false;
            mode2LastError = false;
            
            if (mode === 1) {
                document.querySelector('.mode-1').classList.add('active');
                document.querySelectorAll('.mode-btn')[0].classList.add('active');
                nextMode1();
            } else if (mode === 2) {
                document.querySelector('.mode-2').classList.add('active');
                document.querySelectorAll('.mode-btn')[1].classList.add('active');
                nextMode2();
            } else if (mode === 3) {
                document.querySelector('.mode-3').classList.add('active');
                document.querySelectorAll('.mode-btn')[2].classList.add('active');
                initMode3();
            }
        }

        function toggleSelection(type, value) {
            // Toggle the selection: if already selected, deselect; otherwise select
            mode1State.selected[type] = mode1State.selected[type] === value ? null : value;
            
            // Update button classes based on current state
            document.querySelectorAll(`.toggle-btn`).forEach(btn => {
                const parentGroup = btn.closest('.toggle-group');
                const labelElement = parentGroup?.querySelector('.toggle-label');
                const labelText = labelElement?.textContent || '';
                
                // Determine which group this button belongs to
                let buttonType = null;
                if (labelText === 'Zeit') buttonType = 'tense';
                else if (labelText === 'Person') buttonType = 'person';
                else if (labelText === 'Numerus') buttonType = 'number';
                
                // If this button is in the same group as the one being toggled
                if (buttonType === type) {
                    // Deselect all buttons in this group first
                    btn.classList.remove('selected');
                    
                    // Then select only the currently active button for this group
                    if (type === 'tense' && mode1State.selected.tense === value && btn.textContent.toLowerCase().replace(' ', '') === value) {
                        btn.classList.add('selected');
                    } else if (type === 'person' && mode1State.selected.person === value && btn.textContent.match(/\d/)?.[0] === value) {
                        btn.classList.add('selected');
                    } else if (type === 'number' && mode1State.selected.number === value && ((value === 'sg' && btn.textContent === 'Singular') || (value === 'pl' && btn.textContent === 'Plural'))) {
                        btn.classList.add('selected');
                    }
                }
            });
        }

        function getRandomForm() {
            const verbNames = Object.keys(verbs);
            const randomVerb = verbNames[Math.floor(Math.random() * verbNames.length)];
            const tenses = Object.keys(verbs[randomVerb].conjugations);
            const randomTense = tenses[Math.floor(Math.random() * tenses.length)];
            const numbers = Object.keys(verbs[randomVerb].conjugations[randomTense]);
            const randomNumber = numbers[Math.floor(Math.random() * numbers.length)];
            const persons = Object.keys(verbs[randomVerb].conjugations[randomTense][randomNumber]);
            const randomPerson = persons[Math.floor(Math.random() * persons.length)];
            
            const conjugation = verbs[randomVerb].conjugations[randomTense][randomNumber][randomPerson];
            
            return {
                verb: randomVerb,
                tense: randomTense,
                number: randomNumber,
                person: randomPerson,
                form: conjugation
            };
        }

        function nextMode1() {
            mode1State.form = getRandomForm();
            mode1State.selected = { tense: null, person: null, number: null, verb: null };
            document.getElementById('mode1-question').textContent = mode1State.form.form;
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('mode1-feedback').classList.add('hidden');
            checkInProgress = false;
            document.querySelector('.mode-1 .ok-btn').disabled = false;
        }

        function checkMode1() {
            // Prevent button hammering
            if (checkInProgress) return;
            checkInProgress = true;
            document.querySelector('.mode-1 .ok-btn').disabled = true;
            
            // Cancel any pending timeout
            if (pendingTimeout) clearTimeout(pendingTimeout);
            
            // If last check was an error, clicking OK again moves to next question
            if (mode1LastError) {
                mode1LastError = false;
                nextMode1();
                return;
            }
            
            const isCorrect = 
                mode1State.selected.tense === mode1State.form.tense &&
                mode1State.selected.person === mode1State.form.person &&
                mode1State.selected.number === mode1State.form.number;

            const feedback = document.getElementById('mode1-feedback');
            if (isCorrect) {
                scoreState.correct++;
                feedback.textContent = '✓ Richtig!';
                feedback.className = 'feedback correct';
                mode1LastError = false;
                updateScoreDisplay();
                feedback.classList.remove('hidden');
                
                // Auto-advance on correct answer
                pendingTimeout = setTimeout(() => {
                    nextMode1();
                    pendingTimeout = null;
                }, 1500);
            } else {
                scoreState.incorrect++;
                const correct = `${tenseLongNames[mode1State.form.tense]}, ${personNames[mode1State.form.person]}, ${numberNames[mode1State.form.number]}`;
                feedback.textContent = `✗ Falsch! Korrekt: ${correct}`;
                feedback.className = 'feedback incorrect';
                mode1LastError = true;
                updateScoreDisplay();
                feedback.classList.remove('hidden');
                checkInProgress = false;
                document.querySelector('.mode-1 .ok-btn').disabled = false;
                
                // Don't auto-advance on wrong answer - user needs to click OK again
            }
        }

        function nextMode2() {
            mode2State.form = getRandomForm();
            mode2State.currentQuestion = mode2State.form;
            document.getElementById('mode2-verb').textContent = mode2State.form.verb;
            document.getElementById('mode2-tense').textContent = tenseLongNames[mode2State.form.tense];
            document.getElementById('mode2-person').textContent = personNames[mode2State.form.person];
            document.getElementById('mode2-number').textContent = numberNames[mode2State.form.number];
            document.getElementById('mode2-input').value = '';
            document.getElementById('mode2-feedback').textContent = '';
            document.getElementById('mode2-feedback').classList.add('hidden');
            document.getElementById('mode2-hint').textContent = '';
            document.getElementById('mode2-hint').classList.add('hidden');
            document.getElementById('mode2-input').focus();
            checkInProgress = false;
            document.querySelector('.mode-2 .ok-btn').disabled = false;
        }

        function checkMode2() {
            // Prevent button hammering
            if (checkInProgress) return;
            checkInProgress = true;
            document.querySelector('.mode-2 .ok-btn').disabled = true;
            
            // Cancel any pending timeout
            if (pendingTimeout) clearTimeout(pendingTimeout);
            
            // If last check was an error, clicking Check again moves to next question
            if (mode2LastError) {
                mode2LastError = false;
                nextMode2();
                return;
            }
            
            const userInput = document.getElementById('mode2-input').value.trim().toLowerCase();
            const correctForm = mode2State.form.form.toLowerCase();
            // Normalize both inputs by removing macrons for comparison
            const userInputNormalized = removeMacrons(userInput).toLowerCase();
            const correctFormNormalized = removeMacrons(correctForm).toLowerCase();
            
            const feedback = document.getElementById('mode2-feedback');
            const hint = document.getElementById('mode2-hint');
            const input = document.getElementById('mode2-input');
            
            // Accept answer with or without macrons
            if (userInputNormalized === correctFormNormalized) {
                scoreState.correct++;
                feedback.textContent = '✓ Richtig! Sehr gut!';
                feedback.className = 'feedback correct';
                hint.textContent = '';
                hint.classList.add('hidden');
                mode2LastError = false;
                updateScoreDisplay();
                feedback.classList.remove('hidden');
                
                // Auto-advance on correct answer
                pendingTimeout = setTimeout(() => {
                    nextMode2();
                    pendingTimeout = null;
                }, 1500);
            } else {
                scoreState.incorrect++;
                feedback.textContent = `✗ Falsch. Die richtige Form ist: ${mode2State.form.form}`;
                feedback.className = 'feedback incorrect';
                hint.textContent = `Tipp: Das Infinitiv ist ${mode2State.form.verb}. Die Form, die du suchst, ist: ${mode2State.form.form} (Makronen sind optional)`;
                hint.classList.remove('hidden');
                mode2LastError = true;
                updateScoreDisplay();
                feedback.classList.remove('hidden');
                checkInProgress = false;
                document.querySelector('.mode-2 .ok-btn').disabled = false;
                
                // Clear input and focus for retry on wrong answer
                input.value = '';
                input.focus();
            }
        }
        
        function updateScoreDisplay() {
            document.getElementById('score-correct').textContent = scoreState.correct;
            document.getElementById('score-incorrect').textContent = scoreState.incorrect;
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                checkMode2();
            }
        }

        // Mode 3 functions
        let mode3CurrentVerb = 'amare';

        function initMode3() {
            // Create verb selector buttons
            const selector = document.getElementById('verb-selector');
            selector.innerHTML = '';
            
            const verbNames = Object.keys(verbs);
            verbNames.forEach(verb => {
                const btn = document.createElement('button');
                btn.className = 'verb-btn' + (verb === mode3CurrentVerb ? ' selected' : '');
                btn.textContent = verb;
                btn.onclick = () => showConjugationTable(verb);
                selector.appendChild(btn);
            });
            
            showConjugationTable(mode3CurrentVerb);
        }

        function showConjugationTable(verbName) {
            mode3CurrentVerb = verbName;
            
            // Update selected button
            document.querySelectorAll('.verb-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === verbName) {
                    btn.classList.add('selected');
                }
            });
            
            const verb = verbs[verbName];
            const tenses = Object.keys(verb.conjugations);
            let html = '';
            
            // Create table for each tense
            tenses.forEach(tense => {
                html += `
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #6366f1; margin-bottom: 12px; font-size: 1.2rem;">${tenseLongNames[tense]}</h3>
                    <table class="conjugation-table">
                        <thead>
                            <tr>
                                <th style="width: 25%;">Person</th>
                                <th style="width: 25%;">Singular</th>
                                <th style="width: 25%;">Plural</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>${personNames['1']}</td>
                                <td><strong>${verb.conjugations[tense].sg['1']}</strong></td>
                                <td><strong>${verb.conjugations[tense].pl['1']}</strong></td>
                            </tr>
                            <tr>
                                <td>${personNames['2']}</td>
                                <td><strong>${verb.conjugations[tense].sg['2']}</strong></td>
                                <td><strong>${verb.conjugations[tense].pl['2']}</strong></td>
                            </tr>
                            <tr>
                                <td>${personNames['3']}</td>
                                <td><strong>${verb.conjugations[tense].sg['3']}</strong></td>
                                <td><strong>${verb.conjugations[tense].pl['3']}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                `;
            });
            
            document.getElementById('table-container').innerHTML = html;
        }

        // Initialize
        nextMode1();
    </script>
</body>
</html>